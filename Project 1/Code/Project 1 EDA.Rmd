------------------------------------------------------------------------

title: "Project 1 EDA" author: "Rachel Austin" date: "2026-02-09" output: html_document ---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "/Users/austinra/BIOS6624/Project 1")
library(dplyr)
library(table1)
library(tidyr)
library(Hmisc)
```

```{r}
df <- read.csv("Data Raw/hiv_6624_final.csv")
#Filter dataset to visit years of interest
df <- filter(df, years == 0  |years == 2)
```

```{r}
glimpse(df)
```

```{r}
table(df$years)
```

Measures of Treatment Response:
Laboratory measure: Viral Load (VLOAD) - number of copies of HIV virus 
999999999= 999,999,999 copies/ml (this is a possible value for untreated individuals)

```{r}
summary(df$VLOAD)
table(df$years[is.na(df$VLOAD)])
#42 missing baseline VLOAD, 19 missing year 2 VLOAD
hist(df$VLOAD)
#extremely right skewed let's apply a log transform 
hist(log(df$VLOAD))
#log transform of vload is looking better
```

Laboratory measure: 
CD4+ T cell count (LEU3N) 
Range of possible values: 0-99999

```{r}
summary(df$LEU3N)
hist(df$LEU3N)
table(df$years[is.na(df$LEU3N)])
#24 missing baseline LEU3N, 19 missing year 2 LEU3N
table(df$years[is.na(df$LEU3N)], df$newid[is.na(df$LEU3N)])
```

Quality of Life: Aggregate physical quality of life score (AGG_PHYS)
Range of possible values 6.34-75.54
```{r}
summary(df$AGG_PHYS)
table(df$years[is.na(df$AGG_PHYS)])
#2 missing AGG_PHYS at baseline, 6 missing at year 2
hist(df$AGG_PHYS)
# a little skew but let's leave this as is 
```

Quality of Life: aggregate mental quality of life score (AGG_MENT)
Range of possible values -1.82 - 77.30
```{r}
summary(df$AGG_MENT)
table(df$years[is.na(df$AGG_MENT)])
#2 missing AGG_PHYS at baseline, 6 missing at year 2
hist(df$AGG_MENT)
```

Hard drug use
```{r}
table(df$years[is.na(df$hard_drugs)])
#4 missing values for hard drugs in year 2 
table(df$hard_drugs, useNA = "ifany")
barplot(table(df$hard_drugs))
```

Adherence is an important factor
1 = 100% 
2 = 95-99% 
3 = 75-94% 
4 = < 75%

```{r}
table(df$year, useNA = "ifany")
#Drop-Out: 715 to 506, add to discussion section
table(df$years[is.na(df$ADH)])
#0 missing values for Adherence at year 2
table(df$year, df$ADH, useNA = "ifany")
barplot(table(df$year,df$ADH))
```


Additional predictors to include: 
age, bmi, smoking status, education, race, ethnicity

Age

```{r}
hist(df$age)
sum(is.na(df$age))
#no missing age values
```

BMI
```{r}
hist(df$BMI)
# crazy high BMI value - this has to be an error
filter(df,BMI > 70.1 & BMI <900)
#14 observations with BMI values of -1 (improbable value)
# 1 observation with BMI of 515.0066 and 1 with observation of BMI of 514.2514 - drop these
filter(df, BMI == 999)
#12 observations with BMI values of 999 (insufficient data)
```

Smoking Status
```{r}
table(df$SMOKE[df$years ==0], useNA = "ifany")
#0 missing values for smoking status at baseline
```

Education
1= 8th grade or less education 
(highest grade or 2= 9, 10, or 11th grade level) 
3= 12th grade 4= At least one year college but no degree
5= Four years college / got degree
6= Some graduate work
7= Post-graduate degree Blank= Missing

```{r}
table(df$EDUCBAS[df$years ==0], useNA = "ifany")
#0 missing values at baseline
```


Race
1= White, non-Hispanic
2= White, Hispanic 
3= Black, non-Hispanic
4= Black, Hispanic 
5= American Indian or Alaskan Native 
6= Asian or Pacific Islander 
7= Other 
8= Other Hispanic (created for 2001-03 new recruits) Blank = "Missing"

```{r}
table(df$RACE[df$years ==0], useNA = "ifany")
# o missing values at baseline
```

Explain motivation for data level collapses


What would the number of observations be if we excluded those with missing values and only paired primary outcomes?

Filtered Dataset Exploration
```{r}

#Determine paired outcomes 
paired_df <- df %>%
  group_by(newid) %>%
  summarise(
    has_both_visits = n_distinct(years) == 2,
    VLOAD_paired    = has_both_visits && all(!is.na(VLOAD)),
    LEU3N_paired    = has_both_visits && all(!is.na(LEU3N)),
    AGG_MENT_paired = has_both_visits && all(!is.na(AGG_MENT)),
    AGG_PHYS_paired = has_both_visits && all(!is.na(AGG_PHYS)),
    .groups = "drop"
  )

paired_df %>%
  summarise(
    n_subjects = n(),
    across(ends_with("_paired"), sum)
  )

#Check if QOL measures are the same subjects
setequal(
  paired_df$newid[paired_df$AGG_MENT_paired],
  paired_df$newid[paired_df$AGG_PHYS_paired]
)

#Check if lab measures are the same subjects
setequal(
  paired_df$newid[paired_df$VLOAD_paired],
  paired_df$newid[paired_df$LEU3N_paired]
)

```

AGG_MENT: 481 paired outcomes
AGG_PHYS: 481 paired outcomes
LEU3N: 474 paired outcomes
VLOAD: 474 paired outcomes

Create datasets for each of these outcomes
```{r}
ids_qol   <- paired_df %>% filter(AGG_PHYS_paired)   %>% pull(newid)
ids_vload <- paired_df %>% filter(VLOAD_paired) %>% pull(newid)
ids_leu3n <- paired_df %>% filter(LEU3N_paired) %>% pull(newid)

df_qol <- df %>% filter(newid %in% ids_qol)
df_vload <- df %>% filter(newid %in% ids_vload)
df_leu3n <- df %>% filter(newid %in% ids_leu3n)

```

Check count if we only keep participants with all four measures
```{r}
paired_all4 <- df %>%    
  group_by(newid) %>%
  summarise(
    has_both_visits = n_distinct(years) == 2,
    all4_paired = has_both_visits &&
      all(!is.na(VLOAD)) &&
      all(!is.na(LEU3N)) &&
      all(!is.na(AGG_MENT)) &&
      all(!is.na(AGG_PHYS)),
    .groups = "drop"
  )

# How many subjects meet this?
paired_all4 %>% summarise(n_all4 = sum(all4_paired))

#Dataframe of just these subjects
df_all4 <- df %>%
  semi_join(filter(paired_all4, all4_paired), by = "newid")

```
463 subjects with all four outcomes 





Write dataset to folder for analysis
```{r}
openxlsx::write.xlsx(df_paired_all4, "Data Processed/Analysis Dataset.xlsx")
```
