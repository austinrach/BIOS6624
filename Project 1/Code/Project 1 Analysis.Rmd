---
title: "Project 1 Analysis"
author: "Rachel Austin"
date: "2026-02-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/Users/austinra/BIOS6624/Project 1")
library(openxlsx)
library(dplyr)
library(tidyr)
```

Notes:
difference in difference model with baseline in predictor the same as a outcome with baseline as predictor
model with and without adherence for hard drug and non hard drugs

since var is so big intercept being at 0 is fine
focus on hard drug users and non hard drug users difference

8 models, 4 with primary 4 with QOL and adherence as mediator/covariate

QOL - 2 point change up or down clinically meaningful
CD4 - 50 cells up or down is meaningful
VLOAD - .5 decrease on log 10 up or down is meaningful


people using hard drugs might have a hard time with adherence - can differences found be explained by adherence For covariates should we use baseline or year 2?

Viral load decreasing means treatment is working. CD4 increasing means immune function is improving. QOL scores important

Outcomes are strongly associated with each other. The outcomes are not independent, viral load and cd4 will be inversely related. Hopefully, QOL will improve when viral load decreases and cd4 increases.

If there are differences between subjects who use hard drugs and those who don't can that be explained by adherence levels?

10k MCMC should be enough cmdstan_diagnose should be used to check your models issues to check for: enough data for the model priors specified make sure to show diagnostic graphs


Focus report on the Bayesian results - display frequentist and explain things are similar

Clinical collapsing adherence 95% and above, below 95%
collapse smoker to current smoker and non current smoker

Adherence as confounder (can obscure a relationship or create one that is there) or mediator

Does adherence explain any differences or non differences between a hard drug user


Hard drug user -> adherence (descriptive statistics)
Hard drug use, covariates 
Hard drug use, adherence, covariates
describe the change between the two models, focusing on the covariates

```{r}
df <- read.xlsx("Data Processed/Analysis Dataset.xlsx")

#Change factor variables
df <- df %>% 
  mutate(newid = as.character(newid),
         hard_drugs = factor(hard_drugs),
         smoke = factor(smoke),
         education = factor(education),
         race = factor(race),
         adh_2 = factor(adh_2))
```


Frequentist Approach:

Laboratory Outcome: VLOAD
```{r}
vload.mod <- lm(log_vload_2 ~ log_vload_0 + hard_drugs + age + BMI + smoke + race + education,
  data = df
)
summary(vload.mod)
```
Laboratory Outcome: VLOAD with ADH
```{r}
vload.mod.adh <- lm(log_vload_2 ~ log_vload_0 + hard_drugs + adh_2 + age + BMI + smoke + race + education,
  data = df)

summary(vload.mod.adh)
```
Laboratory Outcome: LEU3N 
```{r}
leu3n.mod <- lm(LEU3N_2 ~ LEU3N_0 + hard_drugs + age + BMI + smoke + race + education, data = df)
summary(leu3n.mod)
```

Laboratory Outcome: LEU3N + ADH 
```{r}
leu3n.mod.adh <- lm(LEU3N_2 ~ LEU3N_0 + hard_drugs + adh_2 + age + BMI + smoke + race + education, data = df)
summary(leu3n.mod.adh)
```

QOL Outcome: AGG_MENT
```{r}
agg_ment.mod <- lm(AGG_MENT_2 ~ AGG_MENT_0 + hard_drugs + age + BMI + smoke + race + education, data = df)
summary(agg_ment.mod)
```

QOL Outcome: AGG_MENT + ADH
```{r}
agg_ment.mod.adh <- lm(AGG_MENT_2 ~ AGG_MENT_0 + hard_drugs + adh_2 + age + BMI + smoke + race + education, data = df)
summary(agg_ment.mod.adh)
```


QOL Outcome: AGG_PHYS 
```{r}
agg_phys.mod <- lm(AGG_PHYS_2 ~ AGG_PHYS_0 + hard_drugs + age + BMI + smoke + race + education, data = df)
summary(agg_phys.mod)
```


QOL Outcome: AGG_PHYS + ADH
```{r}
agg_phys.mod.adh <- lm(AGG_MENT_2 ~ AGG_MENT_0 + hard_drugs + adh_2 + age + BMI + smoke + race + education, data = df)
summary(agg_phys.mod.adh)
```