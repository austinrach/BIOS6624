---
title: "Project 0 EDA"
author: "Rachel Austin'
output: html_document
date: "2026-01-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
df <- read.csv("/Users/austinra/Downloads/Project0_Clean_v2.csv")
```

Missing values but time recorded- the sample could not be analyzed

Sample Interval Decimal Time MEMs and Booklet should not be used

Time since they reported waking up rather than calculated time intervals

Electronic cap - can malfunction if the battery is low, user error - not screwing the cap closed and there can be booklet error so neither of these should be considered the truth 

Agreement between subject's recordings of sample times compared to the times recorded by an electronic monitoring cap. x and y plot of these- is there a strong correlation or association. are people recording the time before or after the cap does? is there bias?

999 is missing

What are the changes to DHEA and cortisol over time?

Cortisol will rise 30 minutes after waking and decrease over the next 10 hours

Make sure to incorporate effects in report

Question 1:
sleep diary reported wake time and mems clock time
What is the agreement between the subject's recordings of sampling times compared to the times recorded by an electric monitoring cap?
Scatter plot of cap time (minutes) from waking up and booklet time (minutes) since waking up (continuous), identity line (calculate yourself)

Each person has four samples per day over three days so they'll have twelve sampling times and twelve recorded cap times
Find the difference between recorded sampling time and recorded cap time, plot this distribution. (if missing don't include that data point)
Record rates of missingness between the caplet time and booklet time
Don't need to stratify by day or sample time

Look at difference between book and cap time in table one
Set up mixed model with book time as outcome, and cap as pred, random effect is subject
think about perfect agreement (intercept and slope - intercept : 0 , slope : 1 if negative then people consistently recording earlier and is positive then people consistently recording later)


Comparing sampling and electric monitoring cap, Mixed model 
pivot to long then implement the model with random component for subject and maybe sample # (check convergence)
Test of association, significant bias


Notes from 01/28/2026

Question 2: 
Are subjects adhering accurately to the +30 min and +10 hour sampling times required by a protocol?
Descriptive statistics okay maybe try a logistic regression analysis with random subject component
Or could pool all samples together

Adherence window
30 minutes and 10 hour after waking
One analysis for good adherence = 7.5 minutes before or after (inclusive) - proportion of those who met this
One analysis for adequate adherence = 15 minutes before or after (inclusive) - proportion of those who met this 
Need deviation variable for both cap and booklet
1. create var that is 30 min from waking and 10 hours
2. create diff variable


Question 3:
Spaghetti plot to determine patterns
Piecewise linear regression (lmm w random slope for subject) - maybe knot at 30 mins less interested in significance, more interested in magnitude/rate 
Maybe a spline  with a single knot at 30 mins

Booklet time or cap time - choose whichever you think is best from a statistical point of view

Biological Range of Data
Cortisol > 26 keep but weird, Cortisol > 80 incorrect - probably a laboratory error
DHEA upper limit on assay is 5.205 (max value in dataset) - probably an error unless this is recorded repeatedy by the same individual (probably exclude these individuals bc they have a different process going ons)
if there is good agreement we can impute, otherwise choose one time 


EDA:
```{r}
glimpse(df)
```
```{r}

#SubjectID needs to be Categorical
#Collection.Date should be Date
#Collection.Sample should be Categorical
#Booket..Clock.Time should be DateTime
#MEMs..Clock.Time should be DateTime
#Sleep.Diary.reported.wake.time should be carried down for each subject by Collection.Date or DAYNUMB

#Sample Intervals should not be used in the analysis - calculate own values
#Booklet..Sample.interval is the Number of hours and minutes from waking recorded by participant formatted as hh:mm where waking was recorded as midnight 00:00
#Booklet..Sample.interval.Decimal.Time..mins. integer representation of previous variable aka number of minutes from waking for the sample as recorded by participant.
# MEMs..Sample.interval  Number of hours and minutes from waking electronic cap stamp formatted as hh:mm where waking was recorded as midnight 00:00
#MEMs..Sample.interval.Decimal.Time..mins. integer representation of previous variable aka number of minutes from waking electronic stamp.


#Cortisol..ug.dl., DHEA..pg.dl., Cortisol..nmol.L., DHEA..nmol.L. can be left as is
```

Outliers: Check no cortisol > 80, check no DHEA >5.205
